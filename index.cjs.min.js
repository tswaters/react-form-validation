"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,n=require("react"),r=(e=n)&&"object"==typeof e&&"default"in e?e.default:e,t=require("prop-types");function o(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function a(){return(a=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e}).apply(this,arguments)}function u(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function l(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?u(Object(r),!0).forEach((function(n){o(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function i(e,n){if(null==e)return{};var r,t,o=function(e,n){if(null==e)return{};var r,t,o={},a=Object.keys(e);for(t=0;t<a.length;t++)r=a[t],n.indexOf(r)>=0||(o[r]=e[r]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)r=a[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function c(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],t=!0,o=!1,a=void 0;try{for(var u,l=e[Symbol.iterator]();!(t=(u=l.next()).done)&&(r.push(u.value),!n||r.length!==n);t=!0);}catch(e){o=!0,a=e}finally{try{t||null==l.return||l.return()}finally{if(o)throw a}}return r}(e,n)||function(e,n){if(!e)return;if("string"==typeof e)return f(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}var s=n.createContext(null),d=function(e){return e.id||e.name},p=n.forwardRef((function(e,t){var o=e.onSubmit,u=i(e,["onSubmit"]),l=n.useRef(t),f=n.useRef({}),p=n.useRef({}),y=n.useCallback((function(e,n){p.current[d(e)]={ref:e,ctx:n}}),[]),v=n.useCallback((function(e){delete p.current[d(e)]}),[]),b=n.useCallback((function(e){var n,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=f.current[e.name];if((r||t)&&(e.setCustomValidity(""),e.checkValidity())){var o=p.current[d(e)].ctx,a=Object.entries(p.current).map((function(e){return c(e,2)[1].ref})),u=(null!==(n=o.validation)&&void 0!==n?n:[]).map((function(n){return n(e,a)})).filter((function(e){return null!=e})),l=c(u,1),i=l[0];"string"==typeof i&&(i=new Error(i)),null!=i?(e.setCustomValidity(i.message),e.checkValidity()):o.updateState(null,e.validity)}}),[]),h=n.useCallback((function(e){var n=e.target;p.current[d(n)].ctx.otherArray.reduce((function(e,n){var r=p.current[n];return r&&e.push(r.ref),e}),[n]).forEach((function(e){return b(e)}))}),[b]),m=n.useCallback((function(e){for(var n=0,r=Object.entries(p.current);n<r.length;n++){var t=c(r[n],2)[1].ref;b(t,!0)}e.target.checkValidity()?null==o||o(e):e.preventDefault()}),[o,b]),g=n.useCallback((function(e){return f.current[e.target.name]=!0}),[f]),O=n.useMemo((function(){return{register:y,unregister:v,validate:h,setInputTouched:g}}),[y,v,h,g]);return r.createElement(s.Provider,{value:O},r.createElement("form",a({ref:l,onSubmit:m},u)))}));p.displayName="Form",p.propTypes={onSubmit:t.func};var y=n.memo(p);y.displayName="Memo(Form)";var v=new Map,b=function(e,r){var t=r.onBlur,o=r.onChange,a=r.onClick,u=r.onFocus,l=r.validation,i=r.other,f=r.recheck,d=r.blur,p=r.change,y=r.click,b=r.onError,h=r.onInvalid,m=r.onValid,g=r.onValidated,O=n.useContext(s),C=O.register,k=O.unregister,j=O.validate,E=O.setInputTouched,S=c(n.useState(!1),2),V=S[0],w=S[1],x=c(n.useState(null),2),A=x[0],P=x[1],I=c(n.useState(null),2),F=I[0],M=I[1],T=c(n.useState(null),2),B=T[0],R=T[1],N=n.useCallback((function(e,n){var r=null==e||!1===e||""===e,t=!r;P(r),R(t),M(r?null:function(e,n){var r=null;for(var t in n)n[t]&&(r=t);var o=function(e,n){return"".concat(n,"_").concat(e.message)}(e,r);return v.has(o)?v.get(o):(e.code=r,v.set(o,e),e)}(e,n)),w(!0)}),[P,R,M,w]);n.useEffect((function(){null==b||b(F),null==h||h(B),null==m||m(A),null==g||g(V)}),[b,h,m,g,F,B,A,V]);var D=n.useCallback((function(e){null==u||u(e),E(e)}),[u,E]),q=n.useCallback((function(e){null==o||o(e),(V&&f||p)&&j(e)}),[o,f,p,V,j]),_=n.useCallback((function(e){null==t||t(e),d&&j(e)}),[t,d,j]),L=n.useCallback((function(e){null==a||a(e),y&&j(e)}),[a,y,j]),U=n.useMemo((function(){return{validation:null==l?null:Array.isArray(l)?l:[l],updateState:N,otherArray:null==i?[]:Array.isArray(i)?i:[i]}}),[l,N,i]);return n.useEffect((function(){var n=e.current;return C(n,U),function(){return k(n)}}),[e,C,k,U]),n.useEffect((function(){var n=e.current,r=function(e){var n=e.target,r=n.validationMessage,t=n.validity;N(new Error(r),t)};return n.addEventListener("invalid",r),function(){return n.removeEventListener("invalid",r)}}),[e,N]),n.useMemo((function(){return{handleBlur:_,handleChange:q,handleClick:L,handleFocus:D}}),[_,q,L,D])},h={onBlur:t.func,onChange:t.func,onClick:t.func,onFocus:t.func,validation:t.oneOfType([t.arrayOf(t.func),t.func]),other:t.oneOfType([t.arrayOf(t.string),t.string]),recheck:t.bool,blur:t.bool,change:t.bool,click:t.bool,onError:t.func,onValid:t.func,onInvalid:t.func,onValidated:t.func,name:t.string.isRequired},m=function(e){var t=n.forwardRef((function(t,o){var a=t.onBlur,u=t.onClick,c=t.onChange,f=t.onFocus,s=t.validation,d=t.other,p=t.recheck,y=t.blur,v=t.change,h=t.click,m=t.onError,g=t.onValid,O=t.onInvalid,C=t.onValidated,k=i(t,["onBlur","onClick","onChange","onFocus","validation","other","recheck","blur","change","click","onError","onValid","onInvalid","onValidated"]),j=n.useRef(o),E=b(j,{onBlur:a,onChange:c,onClick:u,onFocus:f,validation:s,other:d,recheck:p,blur:y,change:v,click:h,onError:m,onValid:g,onInvalid:O,onValidated:C}),S=E.handleBlur,V=E.handleChange,w=E.handleClick,x=E.handleFocus;return r.createElement(e,l({ref:j,onBlur:S,onChange:V,onClick:w,onFocus:x},k))}));return t.displayName="Validated(".concat(e,")"),t.propTypes=h,n.memo(t).displayName="Memo(".concat(t.displayName,")"),t},g=m("input"),O=m("select"),C=m("textarea"),k=function(e){var r=e.children,t=i(e,["children"]),o=c(n.useState(null),2),a=o[0],u=o[1],f=c(n.useState(null),2),s=f[0],d=f[1],p=c(n.useState(null),2),y=p[0],v=p[1],b=c(n.useState(null),2),h=b[0],m=b[1],k=n.useCallback((function(e){return u(e)}),[]),j=n.useCallback((function(e){return d(e)}),[]),E=n.useCallback((function(e){return v(e)}),[]),S=n.useCallback((function(e){return m(e)}),[]);return function e(r,t){return n.Children.map(r,(function(r,o){return n.isValidElement(r)&&n.Children.toArray(r.props.children).some((function(e){return n.isValidElement(e)}))?t(n.cloneElement(r,l({},r.props,{children:e(r.props.children,t)})),o):t(r,o)}))}(r({error:a,valid:s,invalid:y,validated:h}),(function(e){var r=function(e){return n.isValidElement(e)?"input"===e.type?g:"select"===e.type?O:"textarea"===e.type?C:null:null}(e);return null==r?e:n.createElement(r,l({},t,{onError:k,onValid:j,onInvalid:E,onValidated:S},e.props))}))};k.propTypes={children:t.func.isRequired,validation:t.oneOfType([t.func,t.arrayOf(t.func)])},n.memo(k).displayName="Memo(".concat(k.displayName,")"),exports.Form=y,exports.FormContext=s,exports.Input=g,exports.Select=O,exports.TextArea=C,exports.Validator=k;
