import n,{createContext as r,forwardRef as e,useRef as t,useCallback as o,useMemo as i,memo as a,useContext as u,useState as l,useEffect as c,Children as f,isValidElement as d,cloneElement as s,createElement as p}from"react";import{func as v,oneOfType as y,arrayOf as h,string as m,bool as b}from"prop-types";function g(n,r,e){return r in n?Object.defineProperty(n,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[r]=e,n}function O(){return(O=Object.assign||function(n){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t])}return n}).apply(this,arguments)}function j(n,r){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable}))),e.push.apply(e,t)}return e}function k(n){for(var r=1;r<arguments.length;r++){var e=null!=arguments[r]?arguments[r]:{};r%2?j(Object(e),!0).forEach((function(r){g(n,r,e[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):j(Object(e)).forEach((function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(e,r))}))}return n}function C(n,r){if(null==n)return{};var e,t,o=function(n,r){if(null==n)return{};var e,t,o={},i=Object.keys(n);for(t=0;t<i.length;t++)e=i[t],r.indexOf(e)>=0||(o[e]=n[e]);return o}(n,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(t=0;t<i.length;t++)e=i[t],r.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(n,e)&&(o[e]=n[e])}return o}function E(n,r){return function(n){if(Array.isArray(n))return n}(n)||function(n,r){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(n)))return;var e=[],t=!0,o=!1,i=void 0;try{for(var a,u=n[Symbol.iterator]();!(t=(a=u.next()).done)&&(e.push(a.value),!r||e.length!==r);t=!0);}catch(n){o=!0,i=n}finally{try{t||null==u.return||u.return()}finally{if(o)throw i}}return e}(n,r)||function(n,r){if(!n)return;if("string"==typeof n)return V(n,r);var e=Object.prototype.toString.call(n).slice(8,-1);"Object"===e&&n.constructor&&(e=n.constructor.name);if("Map"===e||"Set"===e)return Array.from(e);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return V(n,r)}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function V(n,r){(null==r||r>n.length)&&(r=n.length);for(var e=0,t=new Array(r);e<r;e++)t[e]=n[e];return t}var w=r(null),S=function(n){return n.id||n.name},A=e((function(r,e){var a=r.onSubmit,u=C(r,["onSubmit"]),l=t(e),c=t({}),f=t({}),d=o((function(n,r){f.current[S(n)]={ref:n,ctx:r}}),[]),s=o((function(n){delete f.current[S(n)]}),[]),p=o((function(n){var r,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=c.current[n.name];if((e||t)&&(n.setCustomValidity(""),n.checkValidity())){var o=f.current[S(n)].ctx,i=Object.entries(f.current).map((function(n){return E(n,2)[1].ref})),a=(null!==(r=o.validation)&&void 0!==r?r:[]).map((function(r){return r(n,i)})).filter((function(n){return null!=n})),u=E(a,1),l=u[0];"string"==typeof l&&(l=new Error(l)),null!=l?(n.setCustomValidity(l.message),n.checkValidity()):o.updateState(null,n.validity)}}),[]),v=o((function(n){var r=n.target;f.current[S(r)].ctx.otherArray.reduce((function(n,r){var e=f.current[r];return e&&n.push(e.ref),n}),[r]).forEach((function(n){return p(n)}))}),[p]),y=o((function(n){for(var r=0,e=Object.entries(f.current);r<e.length;r++){var t=E(e[r],2)[1].ref;p(t,!0)}n.target.checkValidity()?null==a||a(n):n.preventDefault()}),[a,p]),h=o((function(n){return c.current[n.target.name]=!0}),[c]),m=i((function(){return{register:d,unregister:s,validate:v,setInputTouched:h}}),[d,s,v,h]);return n.createElement(w.Provider,{value:m},n.createElement("form",O({ref:l,onSubmit:y},u)))}));A.displayName="Form",A.propTypes={onSubmit:v};var P=a(A);P.displayName="Memo(Form)";var I=new Map,F=function(n,r){var e=r.onBlur,t=r.onChange,a=r.onClick,f=r.onFocus,d=r.validation,s=r.other,p=r.recheck,v=r.blur,y=r.change,h=r.click,m=r.onError,b=r.onInvalid,g=r.onValid,O=r.onValidated,j=u(w),k=j.register,C=j.unregister,V=j.validate,S=j.setInputTouched,A=E(l(!1),2),P=A[0],F=A[1],x=E(l(null),2),B=x[0],N=x[1],M=E(l(null),2),T=M[0],D=M[1],q=E(l(null),2),L=q[0],R=q[1],U=o((function(n,r){var e=null==n||!1===n||""===n,t=!e;N(e),R(t),D(e?null:function(n,r){var e=null;for(var t in r)r[t]&&(e=t);var o=function(n,r){return"".concat(r,"_").concat(n.message)}(n,e);return I.has(o)?I.get(o):(n.code=e,I.set(o,n),n)}(n,r)),F(!0)}),[N,R,D,F]);c((function(){null==m||m(T),null==b||b(L),null==g||g(B),null==O||O(P)}),[m,b,g,O,T,L,B,P]);var $=o((function(n){null==f||f(n),S(n)}),[f,S]),_=o((function(n){null==t||t(n),(P&&p||y)&&V(n)}),[t,p,y,P,V]),z=o((function(n){null==e||e(n),v&&V(n)}),[e,v,V]),G=o((function(n){null==a||a(n),h&&V(n)}),[a,h,V]),H=i((function(){return{validation:null==d?null:Array.isArray(d)?d:[d],updateState:U,otherArray:null==s?[]:Array.isArray(s)?s:[s]}}),[d,U,s]);return c((function(){var r=n.current;return k(r,H),function(){return C(r)}}),[n,k,C,H]),c((function(){var r=n.current,e=function(n){var r=n.target,e=r.validationMessage,t=r.validity;U(new Error(e),t)};return r.addEventListener("invalid",e),function(){return r.removeEventListener("invalid",e)}}),[n,U]),i((function(){return{handleBlur:z,handleChange:_,handleClick:G,handleFocus:$}}),[z,_,G,$])},x={onBlur:v,onChange:v,onClick:v,onFocus:v,validation:y([h(v),v]),other:y([h(m),m]),recheck:b,blur:b,change:b,click:b,onError:v,onValid:v,onInvalid:v,onValidated:v,name:m.isRequired},B=function(r){var o=e((function(e,o){var i=e.onBlur,a=e.onClick,u=e.onChange,l=e.onFocus,c=e.validation,f=e.other,d=e.recheck,s=e.blur,p=e.change,v=e.click,y=e.onError,h=e.onValid,m=e.onInvalid,b=e.onValidated,g=C(e,["onBlur","onClick","onChange","onFocus","validation","other","recheck","blur","change","click","onError","onValid","onInvalid","onValidated"]),O=t(o),j=F(O,{onBlur:i,onChange:u,onClick:a,onFocus:l,validation:c,other:f,recheck:d,blur:s,change:p,click:v,onError:y,onValid:h,onInvalid:m,onValidated:b}),E=j.handleBlur,V=j.handleChange,w=j.handleClick,S=j.handleFocus;return n.createElement(r,k({ref:O,onBlur:E,onChange:V,onClick:w,onFocus:S},g))}));return o.displayName="Validated(".concat(r,")"),o.propTypes=x,a(o).displayName="Memo(".concat(o.displayName,")"),o},N=B("input"),M=B("select"),T=B("textarea"),D=function(n){var r=n.children,e=C(n,["children"]),t=E(l(null),2),i=t[0],a=t[1],u=E(l(null),2),c=u[0],v=u[1],y=E(l(null),2),h=y[0],m=y[1],b=E(l(null),2),g=b[0],O=b[1],j=o((function(n){return a(n)}),[]),V=o((function(n){return v(n)}),[]),w=o((function(n){return m(n)}),[]),S=o((function(n){return O(n)}),[]);return function n(r,e){return f.map(r,(function(r,t){return d(r)&&f.toArray(r.props.children).some((function(n){return d(n)}))?e(s(r,k({},r.props,{children:n(r.props.children,e)})),t):e(r,t)}))}(r({error:i,valid:c,invalid:h,validated:g}),(function(n){var r=function(n){return d(n)?"input"===n.type?N:"select"===n.type?M:"textarea"===n.type?T:null:null}(n);return null==r?n:p(r,k({},e,{onError:j,onValid:V,onInvalid:w,onValidated:S},n.props))}))};D.propTypes={children:v.isRequired,validation:y([v,h(v)])},a(D).displayName="Memo(".concat(D.displayName,")");export{P as Form,w as FormContext,N as Input,M as Select,T as TextArea,D as Validator};
